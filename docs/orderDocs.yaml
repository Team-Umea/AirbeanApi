paths:
  /orders:
    post:
      tags:
        - Orders
      summary: Create a new order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NewOrder"
      responses:
        "201":
          description: Order created
        "400":
          description: Invalid input

  /orders/{id}:
    get:
      tags:
        - Orders
      summary: Get a specific order by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Order found
        "404":
          description: Order not found

    delete:
      tags:
        - Orders
      summary: Delete an order
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Order deleted
        "404":
          description: Order not found

  /orders/{orderId}/full:
    get:
      tags:
        - Orders
      summary: Get full order details with items
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Full order data
        "404":
          description: Order not found

  /orders/profile/{profileId}:
    get:
      tags:
        - Orders
      summary: Get all orders by profile ID
      parameters:
        - name: profileId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: List of orders

  /orders/history/{profileId}:
    get:
      tags:
        - Orders
      summary: Get detailed order history by profile ID
      parameters:
        - name: profileId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Order history with item details

  /orders/{id}/status:
    patch:
      tags:
        - Orders
      summary: Update order status
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                newStatus:
                  type: string
              required:
                - newStatus
      responses:
        "200":
          description: Status updated
        "404":
          description: Order not found

  /orders/{id}/confirm:
    patch:
      tags:
        - Orders
      summary: Confirm an order and update product stock
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Order confirmed and stock updated
        "400":
          description: Invalid order state or insufficient stock
        "404":
          description: Order not found

  /orders/product/{productId}:
    get:
      tags:
        - Orders
      summary: Get order items by product and optional date range
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: integer
        - name: start
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: end
          in: query
          required: false
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Order items for given product and date range

components:
  schemas:
    OrderItem:
      type: object
      properties:
        product_id:
          type: integer
        quantity:
          type: integer
        unit_price:
          type: number
      required:
        - product_id
        - quantity
        - unit_price

    NewOrder:
      type: object
      properties:
        profile_id:
          type: integer
        total_amount:
          type: number
        order_status:
          type: string
        order_items:
          type: array
          items:
            $ref: "#/components/schemas/OrderItem"
      required:
        - profile_id
        - total_amount
        - order_status
        - order_items
